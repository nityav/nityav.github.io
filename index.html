<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>TWITCH </title>
    <!-- Bootstrap -->
    <link href="css/bootstrap.min.css" rel="stylesheet" />
    <link href="css/Twitch.css" rel="stylesheet" />
    <!--[if lt IE 9]>
	<script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
	<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
	<![endif]-->
    <script type="text/javascript">
        function getJSONP(url, success) {

            var ud = '_' + +new Date,
					script = document.createElement('script'),
					head = document.getElementsByTagName('head')[0]
							|| document.documentElement;

            window[ud] = function (data) {
                head.removeChild(script);
                success && success(data);
            };

            script.src = url.replace('callback=?', 'callback=' + ud);
            head.appendChild(script);

        }


                function search() {
                    //reset all the page
                    document.getElementById("error").innerHTML = "";
                    document.getElementById("Summary").style.display = 'none';
                    //end reset
                    //creating a global variable
                    key = document.getElementById('query').value;
                    counter = 1;
                    //checking if a key value is empty or default
                    if (key == null || key.trim() == "" || key == "Search Query") {
                        alert('Please enter something');
                        document.getElementById('query').focus();
                        return false; // cancel submission and go back to the textbox
                    }

                    else {
                        var url = 'https://api.twitch.tv/kraken/search/streams?q=' + key + '&limit=10&callback=?'; 
                        // calling the twitch API
                        getJSONP(url, function (data) { // anonymous function to do all the processing
                            if (data._total > 0) { // check if ateast one result exist
                                document.getElementById('total').innerHTML = data._total; // output total results
                                page = Math.ceil(data._total / 10); // creating a page global variable to keep track of the page
                                document.getElementById("pageNumber").innerHTML = '1 /' + page; //display page
                                showResults(data); // show the results 
                                document.getElementById("Summary").style.display = 'block';
                            }
                            else { // no result found
                                document.getElementById("results").innerHTML = "<h3> No results found! please try again</h3>";
                                document.getElementById('query').focus(); // giving the texbox focus again
                            }

                        });
                    }
                }

                function Next() {
                    document.getElementById("error").innerHTML = "";                  
                    if (counter < page) {
                        ++counter;
                        var url = 'https://api.twitch.tv/kraken/search/streams?q=' + key + '&limit=10&offset=' + (counter - 1) * 10 + '&callback=?'
                        getJSONP(url, function (data) {
                            showResults(data);
                            document.getElementById('total').innerHTML = data._total; // in a lot of cases i have observed the total changes so checking it with each call
                            page = Math.ceil(data._total / 10);
                            document.getElementById("pageNumber").innerHTML = counter + "/" + page;
                        });
                    }
                    else {
                        document.getElementById("error").innerHTML = "<h3> No more results</h3>";
                    }

                    console.log(counter);
                }

        function prev() {
            document.getElementById("error").innerHTML = "";
            if (counter > 1) {
                --counter;
                var url = 'https://api.twitch.tv/kraken/search/streams?q=' + key + '&limit=10&offset=' + counter * 10 + '&callback=?'
                getJSONP(url, function (data) {
                    showResults(data);
                    document.getElementById('total').innerHTML = data._total;
                    page = Math.ceil(data._total / 10);
                    document.getElementById("pageNumber").innerHTML = counter + "/" + page;
                });
            }
            else {
                document.getElementById("error").innerHTML = "<h2> No Previous results</h2>";

            }
            console.log(counter);

        }

        function showResults(data) {
            console.log(data);
            var output = '';
            for (var result = 0; result < data.streams.length; result++) {
                output += "<div class=\"col-xs-12 col-sm-12 col-lg-12 stream\"><img class=\"img-test\" src=\"" + data.streams[result].preview.medium + "\"></img><div float=\"right\"><h3>" + data.streams[result].game + "</h3> Game Name:" + data.streams[result].channel.game + " - " + data.streams[result].viewers + " Viewers<br/>Stream Description: " + data.streams[result].channel.status + "</div></div>";
            }
            document.getElementById("results").innerHTML = output;


        }

        function inputFocus(i) {
            if (i.value == i.defaultValue) {
                i.value = "";
                i.style.color = "#000";
            }
        }
        function inputBlur(i) {
            if (i.value == "") {
                i.value = i.defaultValue;
                i.style.color = "#888";
            }
        }


    </script>
</head>
<body>
    <div class="navbar navbar-fixed-top navbar-inverse" role="navigation">
        <div class="container">
            <div class="navbar-header heading">
                <h1>
                    TWITCH</h1>
            </div>
        </div>
        <!-- /.container  -->
    </div>
    <!-- /.navbar -->
    <div class="container">
        <div class="row row-offcanvas row-offcanvas-right">
            <div class="col-xs-12 col-sm-12 col-lg-12 jumbotron">
                <div class="form-group col-lg-11 col-sm-6 col-xs-8">
                    <input type="text" class="form-control" id="query" style="color: #888;" value="Search Query"
                        onfocus="inputFocus(this)" onblur="inputBlur(this)" />
                </div>
                <input class="btn btn-primary col-lg-1" type="button" value="Search" onclick="search()" />
                <div class="row col-xs-12 col-sm-12 col-lg-12">
                    <div id="Summary" style="display: none">
                        <div style="float: left">
                            Total results :<span id="total"></span></div>
                        <div id="pagination" style="float: right">
                            <img src="images/arrow-left.png" id="arrow-left" onclick="prev()" />
                            <span id="pageNumber"></span>
                            <img src="images/arrow-right.png" id="arrow-right" onclick="Next()" />
                        </div>
                    </div>
                </div>
                <!--/row-->
                <div id="error" class="row col-xs-12 col-sm-12 col-lg-12 has-error">
                </div>
                <div id="results" class="row col-xs-12 col-sm-12 col-lg-12">
                </div>
            </div>
            <!--/span-->
        </div>
        <!--/row-->
        <hr />
    </div>
</body>
</html>
